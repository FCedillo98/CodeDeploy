name: Java CD with CodeDeploy

on:
  workflow_run:
    workflows: [Java CI with Gradle]
    types: 
      - completed
jobs:
  on-success:
    runs-on: ubuntu-20.04
    if: ${{ github.event.workflow_run.conclusion == 'success' }}
    steps:
      - name: Clonar repositorio
        uses: actions/checkout@v4
      - name: Instala AWS CLI
        run: sudo apt-get update -y &&
             sudo apt-get upgrade -y &&
             sudo apt-get install awscli -y
      - name: Configurar credenciales de AWS CLI
        uses: aws-actions/configure-aws-credentials@v4
        with:
          aws-region: us-east-1
          aws-access-key-id: "ASIA2IEVWBFIJ4EBBT4Z"
          aws-secret-access-key: "3ECDrKT0IHQy8FABQPooLf6jNeiUm37jG8A8eNvG"
          aws-session-token: "FwoGZXIvYXdzEFsaDE1v0lepv9uY6bfEVyLJAUZdBKm8g9jUaULt9v1rT2EGoXpNUwqaTDlFr3kAjbwSPwFLp+eqpoeaOmyVzRpuGkjaBhK5Q6HkIeUmj4GunfHhI4WbAOdRCY/zMPp1ueJLXz+uipJsyOhT6lphMKJ9NtbWIoMR2zOYTiDIBM9qrt/MSoXusgiVbL9cl79wS6C7x5T9z0MIj/CTNmbfMGWj40e6ThjDXiVLzMRE/u5o6bnR+Gn+wRnJw+jR76vwXfXBLUqyqBHkBN+lZe+MgsE66YdOzCibipTMcCi4z9OuBjItz8/ifTkdj4LFfAeMlfmBJDV6djpmaM9Z5Hu1E5hNKdU/c5m9fL21KNyLy6hD"
      - name: Desplegar aplicaci√≥n con AWS CodeDeploy
        run: aws deploy create-deployment --application-name HolaMundo --application-group-name ImplementacionHolaMundo --revision revisionType=GitHub,gitHubLocation={repository=FCedillo98/CodeDeploy,commitId=4e6b74c01f37b5bc6b2ecde9228f4b959a38e256},fileExistsBehaviour=OVERWRITE
  on-failure:
    runs-on: ubuntu-20.04
    if: ${{ github.event.workflow_run.conclusion == 'failure' }}
    steps:
      - run: echo 'The triggering workflow failed'
